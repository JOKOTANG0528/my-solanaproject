# .gitpod.yml
# è¿™ä¸ªæ–‡ä»¶å®šä¹‰äº† Gitpod å·¥ä½œåŒºçš„é…ç½®

# ä½¿ç”¨ä¸€ä¸ªåŒ…å«å¸¸ç”¨å¼€å‘å·¥å…·çš„æœ€æ–°ç‰ˆ Gitpod é•œåƒ
image: gitpod/workspace-full

# å®šä¹‰åœ¨å·¥ä½œåŒºå¯åŠ¨æ—¶è¦æ‰§è¡Œçš„ä»»åŠ¡
tasks:
  - name: "Setup Solana & Anchor"
    # 'before' è„šæœ¬åªåœ¨å·¥ä½œåŒºç¬¬ä¸€æ¬¡åˆ›å»ºæ—¶è¿è¡Œ
    before: |
      echo "ğŸš€ Starting environment setup..."
      # å®‰è£… Solana CLI
      sh -c "$(curl -sSfL https://release.solana.com/v1.18.15/install)"
      # å°† Solana CLI æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ (å¯¹äºå½“å‰å’Œæœªæ¥çš„ç»ˆç«¯)
      export PATH="/home/gitpod/.local/share/solana/install/active_release/bin:$PATH"
      echo 'export PATH="/home/gitpod/.local/share/solana/install/active_release/bin:$PATH"' >> ~/.bashrc.d/90-solana
      # å®‰è£… Anchor (avm) å’Œ Node.js (nvm)
      curl -sSL https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash
      export NVM_DIR="$HOME/.nvm"
      [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
      nvm install --lts
      npm install -g yarn
      cargo install --git https://github.com/coral-xyz/anchor avm --locked --force
      avm install latest
      avm use latest
      echo "âœ… Environment setup complete!"
    # 'init' è„šæœ¬åœ¨ 'before' ä¹‹åè¿è¡Œï¼Œç”¨äºé¡¹ç›®åˆå§‹åŒ–
    init: |
      echo "ğŸ”§ Initializing workspace..."
      # éªŒè¯å®‰è£…ç‰ˆæœ¬
      solana --version
      rustc --version
      anchor --version
      node --version
      yarn --version
      # è®¾ç½® Solana CLI é…ç½®ä¸ºæœ¬åœ°ç½‘ç»œï¼Œæ–¹ä¾¿å¼€å‘
      solana config set --url localhost
      echo "ğŸ‰ Workspace is ready! You can now create a new Anchor project."

# å®šä¹‰å·¥ä½œåŒºä¸­éœ€è¦æš´éœ²çš„ç«¯å£
ports:
  # Solana æœ¬åœ°éªŒè¯å™¨ç«¯å£
  - port: 8899
    onOpen: ignore
  # Solana äº¤æ˜“æ—¥å¿—ç«¯å£
  - port: 8900
    onOpen: ignore
  # å‰ç«¯å¼€å‘æœåŠ¡å™¨ç«¯å£ (ä¾‹å¦‚ React/Vue)
  - port: 3000
    onOpen: open-preview


